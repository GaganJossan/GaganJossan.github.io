<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FL Coaches Corner</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div id="menuButton" class="menu-icon">
            <div class="bar1"></div>
            <div class="bar2"></div>
            <div class="bar3"></div>
        </div>
        <div id="logoTitleContainer">
            <img src="https://1000logos.net/wp-content/uploads/2017/08/Lululemon-Logo.png" alt="Lululemon Logo" id="logoImage">
            <h1>FL Coaches Corner</h1>
        </div>
        <div id="searchContainer">
            <input type="text" id="searchBar" placeholder="Search by associate user ID...">
            <button id="searchButton">Search</button>
        </div>
    </header>
    <div id="menuOverlay"></div>
    <div id="menu">
        <h2>Menu</h2>
        <a href="#" id="flFeedbacksOverview">FL Feedbacks Overview</a>
        <a href="#" id="associateFeedbacksOverview">Associates Feedbacks Overview</a>
    </div>
    <main>
        <section id="feedbackFormSection">
            <h2>Add Feedback</h2>
            <form id="feedbackForm">
                <label for="dateOfCoaching">Date of Coaching:</label>
                <input type="date" id="dateOfCoaching" required>
                
                <label for="flSubmitted">FL Submitted:</label>
                <input type="text" id="flSubmitted" required>
                
                <label for="topicBulletPoint">Topic:</label>
                <select id="topicBulletPoint" required>
                    <option value="UPH">UPH</option>
                    <option value="Shoutout">Shoutout</option>
                    <option value="Repeat Coaching">Repeat Coaching</option>
                    <option value="Coaching">Coaching</option>
                    <option value="Training">Training</option>
                </select>
                
                <label for="associateName">Associate User ID:</label>
                <input type="text" id="associateName" required>
                
                <label for="feedbackText">Feedback:</label>
                <textarea id="feedbackText" placeholder="Enter feedback here..." required></textarea>
                
                <button type="submit">Submit Feedback</button>
            </form>
        </section>
        <section id="searchResults" style="display: none;">
            <h2>Feedback Summary for <span id="summaryAssociateName"></span></h2>
            <div id="errorMessage" style="display: none; color: red;">No data found for the given associate name.</div>
            <table>
                <thead>
                    <tr>
                        <th>Topic</th>
                        <th>Sum of Events</th>
                    </tr>
                </thead>
                <tbody id="feedbackSummary"></tbody>
            </table>
            <button id="backToMainButton">Back to Main</button>
        </section>
        <section id="detailView" style="display: none;">
            <h2>Detail View</h2>
            <table id="detailTable">
                <thead>
                    <tr>
                        <th>Date Submitted</th>
                        <th>Topic</th>
                        <th>Feedback</th>
                        <th>Submitted By</th>
                        <th>Associate Name</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Detailed rows will be added here -->
                </tbody>
            </table>
            <button id="backToSummaryButton">Back to Summary</button>
        </section>
        <section id="flOverviewSection" style="display: none;">
            <h2>FL Feedbacks Overview</h2>
            <div id="flOverviewCards"></div>
            <button id="backToMainFromOverviewButton">Back to Main</button>
        </section>
        <section id="associateOverviewSection" style="display: none;">
            <h2>Associates Feedbacks Overview</h2>
            <div id="associateOverviewCards"></div>
            <button id="backToMainFromAssociateOverviewButton">Back to Main</button>
        </section>
        <section id="flDetailView" style="display: none;">
            <h2>FL Feedback Details</h2>
            <table id="flDetailTable">
                <thead>
                    <tr>
                        <th>Date Submitted</th>
                        <th>Topic</th>
                        <th>Feedback</th>
                        <th>Submitted By</th>
                        <th>Associate Name</th>
                    </tr>
                </thead>
                <tbody id="flDetailTableBody"></tbody>
            </table>
            <button id="backToOverviewButton">Back to Overview</button>
        </section>
        <section id="associateDetailView" style="display: none;">
            <h2>Associate Feedback Details</h2>
            <table id="associateDetailTable">
                <thead>
                    <tr>
                        <th>Date Submitted</th>
                        <th>Topic</th>
                        <th>Feedback</th>
                        <th>Submitted By</th>
                        <th>Associate Name</th>
                    </tr>
                </thead>
                <tbody id="associateDetailTableBody"></tbody>
            </table>
            <button id="backToAssociateOverviewButton">Back to Overview</button>
        </section>
    </main>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-analytics.js";
      import { getDatabase, ref, set, push, onValue, orderByChild, query, equalTo } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDvkJUQFsAGDQNY__TmKUvom7HkvK_OEsI",
        authDomain: "fl-coaches-corner.firebaseapp.com",
        databaseURL: "https://fl-coaches-corner-default-rtdb.firebaseio.com",
        projectId: "fl-coaches-corner",
        storageBucket: "fl-coaches-corner.appspot.com",
        messagingSenderId: "748798786709",
        appId: "1:748798786709:web:dc7bf765761812489e6f9c",
        measurementId: "G-G0RY03B6D3"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const database = getDatabase(app);

      // Reference to feedback data in Firebase
      const feedbackRef = ref(database, 'feedbacks');

      // Add feedback to Firebase
      function addFeedback(feedback) {
        push(feedbackRef, feedback);
      }

      // Fetch feedbacks from Firebase based on associateName
      function fetchFeedbacks(associateName, callback) {
        const feedbackQuery = query(feedbackRef, orderByChild('associateName'), equalTo(associateName));
        onValue(feedbackQuery, (snapshot) => {
          const feedbacks = [];
          snapshot.forEach((childSnapshot) => {
            feedbacks.push(childSnapshot.val());
          });
          callback(feedbacks);
        });
      }

      // Fetch FL feedback overview
      function fetchFLFeedbacksOverview(callback) {
        onValue(feedbackRef, (snapshot) => {
          const flFeedbacks = {};
          snapshot.forEach((childSnapshot) => {
            const feedback = childSnapshot.val();
            const flName = feedback.flSubmitted.toLowerCase();
            if (!flFeedbacks[flName]) {
              flFeedbacks[flName] = { name: feedback.flSubmitted, count: 0 };
            }
            flFeedbacks[flName].count++;
          });
          callback(flFeedbacks);
        });
      }

      // Fetch associate feedback overview
      function fetchAssociateFeedbacksOverview(callback) {
        onValue(feedbackRef, (snapshot) => {
          const associateFeedbacks = {};
          snapshot.forEach((childSnapshot) => {
            const feedback = childSnapshot.val();
            const associateName = feedback.associateName.toLowerCase();
            if (!associateFeedbacks[associateName]) {
              associateFeedbacks[associateName] = { name: feedback.associateName, count: 0 };
            }
            associateFeedbacks[associateName].count++;
          });
          callback(associateFeedbacks);
        });
      }

      // Fetch detailed feedback for a specific FL
      function fetchFLDetails(flName, callback) {
        const feedbackQuery = query(feedbackRef, orderByChild('flSubmitted'), equalTo(flName));
        onValue(feedbackQuery, (snapshot) => {
          const feedbacks = [];
          snapshot.forEach((childSnapshot) => {
            feedbacks.push(childSnapshot.val());
          });
          callback(feedbacks);
        });
      }

      // Fetch detailed feedback for a specific associate
      function fetchAssociateDetails(associateName, callback) {
        const feedbackQuery = query(feedbackRef, orderByChild('associateName'), equalTo(associateName));
        onValue(feedbackQuery, (snapshot) => {
          const feedbacks = [];
          snapshot.forEach((childSnapshot) => {
            feedbacks.push(childSnapshot.val());
          });
          callback(feedbacks);
        });
      }

      document.addEventListener('DOMContentLoaded', () => {
        // Event listener for the feedback form submission
        document.getElementById('feedbackForm').addEventListener('submit', (event) => {
          event.preventDefault();

          const dateOfCoaching = document.getElementById('dateOfCoaching').value;
          const flSubmitted = document.getElementById('flSubmitted').value.trim();
          const topicBulletPoint = document.getElementById('topicBulletPoint').value;
          const associateName = document.getElementById('associateName').value.trim();
          const feedbackText = document.getElementById('feedbackText').value.trim();

          if (!dateOfCoaching || !flSubmitted || !topicBulletPoint || !associateName || !feedbackText) {
            alert('Please fill in all fields before submitting.');
            return;
          }

          const feedback = {
            date: new Date().toISOString().slice(0, 10),
            flSubmitted: flSubmitted,
            topic: topicBulletPoint,
            associateName: associateName,
            feedback: feedbackText
          };

          addFeedback(feedback);
          document.getElementById('feedbackForm').reset();
          alert('Feedback submitted successfully!');
        });

        // Event listener for search button click
        document.getElementById('searchButton').addEventListener('click', () => {
          const searchBar = document.getElementById('searchBar');
          const searchName = searchBar.value.trim().toLowerCase();
          if (searchName) {
            fetchFeedbacks(searchName, (feedbacks) => {
              displayFeedbackSummary(searchName, feedbacks);
            });
          } else {
            alert('Please enter an associate user ID.');
          }
        });

        // Event listener for pressing Enter in the search bar
        document.getElementById('searchBar').addEventListener('keypress', (event) => {
          if (event.key === 'Enter') {
            event.preventDefault();
            document.getElementById('searchButton').click();
          }
        });

        // Function to display feedback summary
        function displayFeedbackSummary(searchName, feedbacks) {
          const summaryAssociateName = document.getElementById('summaryAssociateName');
          const feedbackSummary = document.getElementById('feedbackSummary');
          const searchResults = document.getElementById('searchResults');
          const feedbackFormSection = document.getElementById('feedbackFormSection');
          const flOverviewSection = document.getElementById('flOverviewSection');
          const associateOverviewSection = document.getElementById('associateOverviewSection');
          const detailView = document.getElementById('detailView');
          const flDetailView = document.getElementById('flDetailView');
          const associateDetailView = document.getElementById('associateDetailView');
          const backToMainButton = document.getElementById('backToMainButton');
          const backToSummaryButton = document.getElementById('backToSummaryButton');
          const errorMessage = document.getElementById('errorMessage');

          // Add event listeners for navigation buttons
          backToMainButton.addEventListener('click', () => {
            feedbackFormSection.style.display = 'block';
            searchResults.style.display = 'none';
            flOverviewSection.style.display = 'none';
            associateOverviewSection.style.display = 'none';
            detailView.style.display = 'none';
            flDetailView.style.display = 'none';
            associateDetailView.style.display = 'none';
          });

          backToSummaryButton.addEventListener('click', () => {
            detailView.style.display = 'none';
            searchResults.style.display = 'block';
          });

          if (feedbacks.length === 0) {
            errorMessage.style.display = 'block';
            feedbackSummary.innerHTML = '';
          } else {
            errorMessage.style.display = 'none';
            let displayName = searchName.charAt(0).toUpperCase() + searchName.slice(1);
            summaryAssociateName.textContent = displayName;
            feedbackSummary.innerHTML = '';
            let topics = {};

            feedbacks.forEach(f => {
              if (!topics[f.topic]) {
                topics[f.topic] = [];
              }
              topics[f.topic].push(f);
            });

            for (let topic in topics) {
              let row = feedbackSummary.insertRow();
              let topicCell = row.insertCell(0);
              let button = document.createElement('button');
              button.textContent = topic;
              button.onclick = () => displayDetails(topics[topic]);
              button.style.cursor = 'pointer';
              button.className = 'topicButton'; // Added class for styling
              topicCell.appendChild(button);
              row.insertCell(1).textContent = topics[topic].length;
            }
          }

          searchResults.style.display = 'block';
          feedbackFormSection.style.display = 'none';
          flOverviewSection.style.display = 'none';
          associateOverviewSection.style.display = 'none';
          detailView.style.display = 'none';
          flDetailView.style.display = 'none';
          associateDetailView.style.display = 'none';
        }

        // Function to display detailed feedback
        function displayDetails(topicFeedbacks) {
          const detailTableBody = document.querySelector('#detailTable tbody');
          const detailView = document.getElementById('detailView');
          const searchResults = document.getElementById('searchResults');

          detailTableBody.innerHTML = '';
          topicFeedbacks.forEach(f => {
            let row = detailTableBody.insertRow();
            row.insertCell(0).textContent = f.date;
            row.insertCell(1).textContent = f.topic;
            row.insertCell(2).textContent = f.feedback;
            row.insertCell(3).textContent = f.flSubmitted;
            row.insertCell(4).textContent = f.associateName;
          });

          detailView.style.display = 'block';
          searchResults.style.display = 'none';
        }

        // Menu button functionality
        const menuButton = document.getElementById('menuButton');
        const menuOverlay = document.getElementById('menuOverlay');
        const menu = document.getElementById('menu');

        menuButton.addEventListener('click', () => {
          menu.classList.toggle('open');
          menuOverlay.style.display = menu.classList.contains('open') ? 'block' : 'none';
        });

        menuOverlay.addEventListener('click', () => {
          menu.classList.remove('open');
          menuOverlay.style.display = 'none';
        });

        // Event listener for FL Feedbacks Overview link
        document.getElementById('flFeedbacksOverview').addEventListener('click', (event) => {
          event.preventDefault();
          fetchFLFeedbacksOverview((flFeedbacks) => {
            displayFLFeedbacksOverview(flFeedbacks);
          });
        });

        // Function to display FL feedback overview
        function displayFLFeedbacksOverview(flFeedbacks) {
          const flOverviewSection = document.getElementById('flOverviewSection');
          const feedbackFormSection = document.getElementById('feedbackFormSection');
          const searchResults = document.getElementById('searchResults');
          const detailView = document.getElementById('detailView');
          const flDetailView = document.getElementById('flDetailView');
          const associateOverviewSection = document.getElementById('associateOverviewSection');
          const associateDetailView = document.getElementById('associateDetailView');
          const flOverviewCards = document.getElementById('flOverviewCards');
          const backToMainFromOverviewButton = document.getElementById('backToMainFromOverviewButton');

          // Add event listener for back button
          backToMainFromOverviewButton.addEventListener('click', () => {
            flOverviewSection.style.display = 'none';
            feedbackFormSection.style.display = 'block';
          });

          flOverviewCards.innerHTML = '';
          for (let fl in flFeedbacks) {
            let card = document.createElement('div');
            card.className = 'fl-card';
            let flName = document.createElement('h3');
            flName.textContent = flFeedbacks[fl].name;
            let flCount = document.createElement('p');
            flCount.textContent = `Total Feedback Provided: ${flFeedbacks[fl].count}`;
            let button = document.createElement('button');
            button.textContent = 'View Details';
            button.onclick = () => displayFLDetails(flFeedbacks[fl].name);
            button.className = 'flButton';

            card.appendChild(flName);
            card.appendChild(flCount);
            card.appendChild(button);
            flOverviewCards.appendChild(card);
          }

          flOverviewSection.style.display = 'block';
          feedbackFormSection.style.display = 'none';
          searchResults.style.display = 'none';
          detailView.style.display = 'none';
          flDetailView.style.display = 'none';
          associateOverviewSection.style.display = 'none';
          associateDetailView.style.display = 'none';
        }

        // Function to display detailed feedback for a specific FL
        function displayFLDetails(flName) {
          fetchFLDetails(flName, (feedbacks) => {
            const flDetailView = document.getElementById('flDetailView');
            const flDetailTableBody = document.getElementById('flDetailTableBody');
            const flOverviewSection = document.getElementById('flOverviewSection');
            const backToOverviewButton = document.getElementById('backToOverviewButton');

            // Add event listener for back button
            backToOverviewButton.addEventListener('click', () => {
              flDetailView.style.display = 'none';
              flOverviewSection.style.display = 'block';
            });

            flDetailTableBody.innerHTML = '';
            feedbacks.forEach(f => {
              let row = flDetailTableBody.insertRow();
              row.insertCell(0).textContent = f.date;
              row.insertCell(1).textContent = f.topic;
              row.insertCell(2).textContent = f.feedback;
              row.insertCell(3).textContent = f.flSubmitted;
              row.insertCell(4).textContent = f.associateName;
            });

            flDetailView.style.display = 'block';
            flOverviewSection.style.display = 'none';
          });
        }

        // Event listener for Associates Feedbacks Overview link
        document.getElementById('associateFeedbacksOverview').addEventListener('click', (event) => {
          event.preventDefault();
          fetchAssociateFeedbacksOverview((associateFeedbacks) => {
            displayAssociateFeedbacksOverview(associateFeedbacks);
          });
        });

        // Function to display associate feedback overview
        function displayAssociateFeedbacksOverview(associateFeedbacks) {
          const associateOverviewSection = document.getElementById('associateOverviewSection');
          const feedbackFormSection = document.getElementById('feedbackFormSection');
          const searchResults = document.getElementById('searchResults');
          const detailView = document.getElementById('detailView');
          const flDetailView = document.getElementById('flDetailView');
          const flOverviewSection = document.getElementById('flOverviewSection');
          const associateDetailView = document.getElementById('associateDetailView');
          const associateOverviewCards = document.getElementById('associateOverviewCards');
          const backToMainFromAssociateOverviewButton = document.getElementById('backToMainFromAssociateOverviewButton');

          // Add event listener for back button
          backToMainFromAssociateOverviewButton.addEventListener('click', () => {
            associateOverviewSection.style.display = 'none';
            feedbackFormSection.style.display = 'block';
          });

          associateOverviewCards.innerHTML = '';
          for (let associate in associateFeedbacks) {
            let card = document.createElement('div');
            card.className = 'associate-card';
            let associateName = document.createElement('h3');
            associateName.textContent = associateFeedbacks[associate].name;
            let associateCount = document.createElement('p');
            associateCount.textContent = `Total Feedback Provided: ${associateFeedbacks[associate].count}`;
            let button = document.createElement('button');
            button.textContent = 'View Details';
            button.onclick = () => fetchFeedbacks(associateFeedbacks[associate].name.toLowerCase(), (feedbacks) => {
              displayFeedbackSummary(associateFeedbacks[associate].name.toLowerCase(), feedbacks);
            });
            button.className = 'associateButton';

            card.appendChild(associateName);
            card.appendChild(associateCount);
            card.appendChild(button);
            associateOverviewCards.appendChild(card);
          }

          associateOverviewSection.style.display = 'block';
          feedbackFormSection.style.display = 'none';
          searchResults.style.display = 'none';
          detailView.style.display = 'none';
          flDetailView.style.display = 'none';
          flOverviewSection.style.display = 'none';
          associateDetailView.style.display = 'none';
        }

        // Function to display detailed feedback for a specific associate
        function displayAssociateDetails(associateName) {
          fetchAssociateDetails(associateName, (feedbacks) => {
            const associateDetailView = document.getElementById('associateDetailView');
            const associateDetailTableBody = document.getElementById('associateDetailTableBody');
            const associateOverviewSection = document.getElementById('associateOverviewSection');
            const backToAssociateOverviewButton = document.getElementById('backToAssociateOverviewButton');

            // Add event listener for back button
            backToAssociateOverviewButton.addEventListener('click', () => {
              associateDetailView.style.display = 'none';
              associateOverviewSection.style.display = 'block';
            });

            associateDetailTableBody.innerHTML = '';
            feedbacks.forEach(f => {
              let row = associateDetailTableBody.insertRow();
              row.insertCell(0).textContent = f.date;
              row.insertCell(1).textContent = f.topic;
              row.insertCell(2).textContent = f.feedback;
              row.insertCell(3).textContent = f.flSubmitted;
              row.insertCell(4).textContent = f.associateName;
            });

            associateDetailView.style.display = 'block';
            associateOverviewSection.style.display = 'none';
          });
        }
      });
    </script>
</body>
</html>
